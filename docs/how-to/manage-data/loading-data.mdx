---
sidebar_position: 1
title: Loading Custom Data
---

import addingAttributes from "/static/ui-videos/how-to/loading-data/attributes-to-user.mp4";

There are multiple ways you can load data into Permit, and we will cover all of them below.

## Via a user in the UI

When navigating to the user interface, you have the option to edit the user attributes for each unique user. These attributes
are then sent to the Permit backend and stored by with the user record in our database.

As you perform a `permit.check()` for any individual user to check his access, these attributes are dynamically loaded into the
function and the enforcement is evaluated based on the policy and the user attributes.

<video controls autoPlay loop playsInline>
	<source src={addingAttributes} />
</video>

## Via the `permit.check()` function

As a `permit.check()` is called, it checks and verifies the actions a user might have on a particular resource. The three parameters
you need to pass into the function are the `unique user id`, `action` and `resource`. As part of the function, rather than passing
in the `user id` and `resource`, you can pass in a whole object that will contain the user or resource attributes.

These attributes are evaluated on each enforcement check. This also gives you the flexibility to pass in **dynamic**
/ **just-in-time** attributes and evaluate these against the policies.

Here is an example of the code:

```javascript
const permitted = await permit.check(
	{
		key: "john@smith.com",
		attributes: {
			location: "England",
			department: "Engineering",
		},
	},
	"read",
	{
		type: "file",
		attributes: {
			isPaying: "true",
		},
	}
);
```

## Via the API

Permit offers a beautiful API editor for dealing with structuring your policies, looking into audits, managing your
team members and so on. It's important not to forget that the whole no-code UI is fully **API driven**, meaning you can
automate any of the actions.

:::note
You can find the whole redoc referencing all the API functionality [here](https://api.permit.io/v2/redoc).
:::

In the meanwhile, let's look into some shortcuts that can be accomplished with the use of the API.

### Dynamically adding actions to every new resource in the same request

Add `default_resource_actions` to your env settings like this (note that you need to set the `permit_env_api_key`).

Here is the example code:

```bash
curl --location --request PATCH 'https://api.permit.io/v2/projects/:project_id/envs/:env_id' \
--header 'authority: api.permit.io' \
--header 'authorization: Bearer permit_env_api_key' \
--header 'origin: https://app.permit.io' \
--header 'Content-Type: application/json' \
--data-raw '{"settings":{"default_resource_actions":["read","write"]}}'
```

## Via OPAL

With the new Scope Config API, you can set your own data sources for your GitOps policy, and combine [Permit.io](http://permit.io/)'s
ease of use, with OPAL's customizability.

Use the [OPAL Scope API](https://api.permit.io/v2/projects/%7Bproj_id%7D/%7Benv_id%7D/opal_scope) to modify the OPAL Scope used.
You will need to pass in the project and env id's into the API endpoint URL, so refer to [this](/api/examples/get-project-and-env)
guide to fetch them.

By default, Permit loads data about users, roles, and so on, to OPA from the Permit cloud. You can use this API to load additional
data sources to use in your custom policy.

In this example, we will load data about countries of the world using [https://restcountries.com](https://restcountries.com/).

### Set custom data sources using the API

```
curl --location --request PUT '[https://api.permit.io/v2/projects/{project_id}/{env_id}/opal_scope](https://api.permit.io/v2/projects/%7Bproject_id%7D/%7Benv_id%7D/opal_scope)' \

--header 'Content-Type: application/json' \

--header 'Accept: application/json' \

--header 'Authorization: Bearer permit_key_***' \

--data '{

     "data": {

          "entries": [

               {

                    "url": "<https://restcountries.com/v3.1/all>",

                    "dst_path": "/countries",

                    "config": {

                         "headers": {

                              "Accept": "application/json"

                         }

                    }

               }

          ]

     }


}'
```

In order to see the new data, you can request the data path from your local PDP.

```bash
curl --location --request GET '<http://localhost:8181/v1/data>' \
--header 'Authorization: Bearer permit*key* {{secret}}'
```

API Docs for Scope Request (API still in beta):

![](/img/features/projects-and-env/scope-api.png)

You can view the full OPAL Scope documentation here:[ https://docs.opal.ac/getting-started/running-opal/run-opal-server/data-sources](https://docs.opal.ac/getting-started/running-opal/run-opal-server/data-sources)

**Custom scopes are supported from PDP \*\***v0.2.15, \*\*so you may need to run: docker pull permitio/pdp-v2:latest

And the following flag needs to be enabled when you run the container:

_OPAL_SPLIT_ROOT_DATA=1_

**E.G if you run it with docker:**

docker run -e PDP*API_KEY=permit_key*\*\*\* -e OPAL_SPLIT_ROOT_DATA=1 permitio/pdp-v2:latest

This is it, you now have a running instance of PDP with custom scopes!

You can also use the custom data source in your rego like this (if you have the gitops feature enabled for you):

data.countries[0].capital == "Bridgetown"
