import CodeDropdown from "@site/src/components/elements/CodeDropdown.js";
import HelpSupportTile from "@site/src/components/elements/HelpSupportTile.js";
import code from "@site/src/components/elements/codeBlock.json";

# Embedding Permit Elements into your App

<span className="subtitle-custom">
	Implementing Elements into your App is simple.
</span>
<br />
<br />

After you finish configuring and customising your element, you are ready to it into your App. A code snippet for the element
will be generated for you.
This will be an `<iframe>` that you can insert anywhere into your website. It will looks like the code snippet below.

```html
<iframe
	title="Permit Element Name"
	src="https://embed.permit.io/name?envId=<SOME_UNIQUE_ID>"
	width="100%"
	height="100%"
	style="border: none;"
/>
```

Once the `<iframe>` is embedded, you need to follow these three steps for the code to take effect and work in your App.

## Creating a Backend Login Route

You need to create a route in your backend server to allow your client to `login_as` themselves, and therefore get access the Permit Element.
There is **three ways** to do his based on your implementations and how you are authenticating your users.

The way you decide to implement authentication and introduce security in the backend **will have to correspond with how you will be
handling this process in your frontend logic**.

### Defining the Backend Login Method

<CodeDropdown
	number="1.1"
	title="Using Cookies"
	server
	code={[code.cookies_python]}
	language={["python"]}
	languages={["python"]}
></CodeDropdown>

<CodeDropdown
	number="1.2"
	title="Using Bearer Token"
	server
	code={[code.bearer]}
	language={["python"]}
	languages={["python"]}
></CodeDropdown>

<CodeDropdown
	number="1.3"
	title="Using Other Headers"
	server
	code={[code.other_headers]}
	language={["python"]}
	languages={["python"]}
>
	If you don't want to use **Cookies** or a **Bearer Token** to authenticate,
	you can pass any other custom Authentication Header.
</CodeDropdown>

## Installing and Initializing Permit

<CodeDropdown
	number="2"
	title="Set up Permit"
	client
	code={[code.npm, code.yarn]}
	showLineNumbers={false}
	language={["javascript"]}
	languages={["npm", "yarn"]}
	open
>
	Add the Permit JavaScript SDK to you app by running:
</CodeDropdown>

<CodeDropdown
	number="3"
	title="Initialize Permit"
	server
	code={[code.initialize]}
	language={["javascript"]}
	languages={["Node"]}
	open
>
	Add the Permit JavaScript SDK to you app. Remember to copy the `SDK Secret
	Key` from the Permit dashboard and pass it into the initialised Permit object.
</CodeDropdown>

## Creating a Frontend Login Route

This function should be called as early as possible in your App. This is best done inside a `middleware function`; **right after** the users
had just had their identity confirmed by the Authorization provider you are using, but **just before** the App loads.

<CodeDropdown
    number="4"
    title="Elements Login Route"
    client
    code={[code.elementLogin]}
	language={["javascript"]}
	languages={["Node"]}
    open
>
    This is the permit element object that is calling the backend route we have
    configured previously and logging in the user.

</CodeDropdown>

There are **four** things that need to be configured here:

1.  `loginUrl` - The url that corresponds to your backend login route you created in the last step.
2.  `tenant` (Optional) - The name of the tenant that the user is part of.
3.  `token` - The Secret Key from the Permit dashboard.
4.  `loginMethod` - The login method you selected in the backend, and therefore has to correlate with the frontend to avoid problems with `CORS`.

### Defining the Frontend Login Method

There are **3 supported login methods**.

<CodeDropdown
	number="4.1"
	title="Cookie Login Method"
	client
	code={[code.loginDefault]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.cookie`.
</CodeDropdown>

<CodeDropdown
	number="4.2"
	title="Bearer Token Login Method"
	client
	code={[code.loginHeaders]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.bearer`.
</CodeDropdown>

<CodeDropdown
	number="4.3"
	title="Other Header Login Method"
	client
	code={[code.other_headers]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.header`.
</CodeDropdown>

After you run login successfully you will **get a cookie** called `permit_session` which will allow you to
load your `<iframe />` securly and successfully.

## Creating the Logout Route

This function should be called along with the logging-out logic that you have within your App, to make sure the user does not
continue to have access to the Permit Element.

<CodeDropdown
number="5"
title="Elements Logout Route"
client
code={[code.elementLogout]}
language={["javascript"]}
languages={["Node"]}
open
>

</CodeDropdown>

## Possible Login Errors

There are a few possible errors you might find yourself come across while working with the embedding of Permit Elements.

#### Error: `USER_NOT_FOUND`

The `User not found` error can appear if you are trying to log in as a particular user, but that user does not exist within Permit.

#### Error: `TENANT_NOT_FOUND`

The `Tenant not found` error can appear when you are passing in a tenant, either in the frontend `permit.elements.login` function, or in
your backend url endpoint, where the tenant has not been created in Permit.

#### Error: `INVALID_PERMISSION_LEVEL`

The `Invalid permission level` will emerge when you are trying to access part of the Element which you have not been given access too.
This usually means the role that the person obtained has remained in the **Hidden Roles** permission level.

#### Error: `FORBIDDEN_ACCESS`

The `Forbidden access` will emerge when you are trying to login to an Element you have not been given permission to see.

<HelpSupportTile />
