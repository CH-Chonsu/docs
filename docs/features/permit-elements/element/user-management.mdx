import HelpSupportTile from "@site/src/components/elements/HelpSupportTile.js";
import ActionContainer from "@site/src/components/elements/ActionContainer.js";
import ActionTile from "@site/src/components/elements/ActionTile.js";
import CodeDropdown from "@site/src/components/elements/CodeDropdown.js";
import FlexWrapper from "@site/src/components/elements/FlexWrapper.js";
import code from "@site/src/components/elements/codeBlock.json";

# User Management Element

<span className="subtitle-custom">
	Effortlessly manage users and their permissions as a single secure, embeddable
	UI component.
</span>
<br />
<br />
The User Management Element is an embeddable UI component that lets you take control
of your whole team, and give other team members specific permissions levels that
reflect how they can manage other users on your team.
<br />
<br />

_![Audit Logs Element](/img/elements/user-management-full.png)_

<h2>Element setup process</h2>

<FlexWrapper>
	<ActionTile
		title="1. Install Permit"
		description="Install the permit-js package into your application."
		redirect="/features/permit-elements/element/user-management#install-permit-js"
	/>
	<ActionTile
		title="2. Initialize Permit"
		description="Create an instance of Permit."
		redirect="/features/permit-elements/element/user-management#initializing-permit"
	/>
	<ActionTile
		title="3. Servier-side login route"
		description="Login a user securely into an element."
		redirect="/features/permit-elements/element/user-management#server-side-login-route"
	/>
	<ActionTile
		title="4. Client-side login method"
		description="Send the user unique ID to your backend."
		redirect="/features/permit-elements/element/user-management#client-side-login-method"
	/>
	<ActionTile
		title="5. Client-side logout method"
		description="Log the user out from the element."
		redirect="/features/permit-elements/element/user-management#client-side-logout-method"
	/>
	<ActionTile
		title="6. Possible login errors"
		description="Find out why you might be seeing some errors."
		redirect="/features/permit-elements/element/user-management#login-errors"
	/>
</FlexWrapper>

<h2>Element Configurtion and Customization</h2>

<FlexWrapper>
	<ActionTile
		text="text-white"
		bg="bg-[#6851ff]"
		bg2="bg-[#4b2fff]"
		title="1. Match your brand"
		description="Change colors, titles and buttons to what suits your brand most."
		redirect="/features/permit-elements/element/user-management#match-your-brand"
	/>
	<ActionTile
		text="text-white"
		bg="bg-[#a796ff]"
		bg2="bg-[#8573ff]"
		title="2. Configure the Webhook"
		description="Stay informed of relevant events from your end users."
		redirect="/features/permit-elements/element/user-management#configure-your-webhook"
	/>
</FlexWrapper>

## Setting up your application

### Install Permit-js

Once you have your application ready, you need to install Permits's JS SDK. This gives you access to our prebuilt embeddable Element components.

<CodeDropdown
	number="1"
	title=""
	client
	code={[code.npm, code.yarn]}
	showLineNumbers={false}
	language={["javascript"]}
	languages={["npm", "yarn"]}
	open
>
	Add the Permit JavaScript SDK to you app:
</CodeDropdown>

### Initializing Permit

<CodeDropdown
	number="2"
	title=""
	server
	code={[code.initialize]}
	language={["javascript"]}
	languages={["Node"]}
	open
>
	In order to use Permit Elements, you need to be a **user of Permit**. When starting to use Permit, you will need to 
	initialize an instance of Permit in your backend logic. This **only needs to be done once**, both to use Permit and Elements.
	Please rememeber to copy your `SDK Secret Key` and pass it into the initialized Permit object.

</CodeDropdown>

### Server-side Login Route

You need to create a route in your backend server to allow your client to `login_as` themselves, and therefore get access the Permit Element.

<CodeDropdown
	number="3"
	title=""
	server
	code={[code.generic_login_as]}
	language={["javascript"]}
	languages={["Node"]}
	open
></CodeDropdown>

There is **three ways** to do his based on your implementations and how you are authenticating your users.

The way you decide to implement authentication and introduce security in the backend **will have to correspond with how you will be
handling this process in your frontend logic**.

<CodeDropdown
	number="3.1"
	title="Using Cookies"
	server
	code={[code.cookies_python]}
	language={["python"]}
	languages={["python"]}
></CodeDropdown>

<CodeDropdown
	number="3.2"
	title="Using Bearer Token"
	server
	code={[code.bearer]}
	language={["python"]}
	languages={["python"]}
></CodeDropdown>

<CodeDropdown
	number="3.3"
	title="Using Other Headers"
	server
	code={[code.other_headers]}
	language={["python"]}
	languages={["python"]}
>
	If you don't want to use **Cookies** or a **Bearer Token** to authenticate,
	you can pass any other custom Authentication Header.
</CodeDropdown>

### Client-side login method

This function should be called as early as possible in your App. This is best done inside a `middleware function`; **right after** the users
had just had their identity confirmed by the Authorization provider you are using, but **just before** the App loads.

<CodeDropdown
    number="4"
    title=""
    client
    code={[code.elementLogin]}
	language={["javascript"]}
	languages={["Node"]}
    open
>
    This is the permit element object that is calling the backend route we have
    configured previously and logging in the user.

</CodeDropdown>

There are **four** things that need to be configured here:

1.  `loginUrl` - The url that corresponds to your backend login route you created in the last step.
2.  `tenant` (Optional) - The name of the tenant that the user is part of.
3.  `token` - The Secret Key from the Permit dashboard.
4.  `loginMethod` - The login method you selected in the backend, and therefore has to correlate with the frontend to avoid problems with `CORS`.

There are **3 supported login methods**.

<CodeDropdown
	number="4.1"
	title="Cookie Login Method"
	client
	code={[code.loginDefault]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.cookie`.
</CodeDropdown>

<CodeDropdown
	number="4.2"
	title="Bearer Token Login Method"
	client
	code={[code.loginHeaders]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.bearer`.
</CodeDropdown>

<CodeDropdown
	number="4.3"
	title="Other Header Login Method"
	client
	code={[code.other_headers]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.header`.
</CodeDropdown>

After you run login successfully you will **get a cookie** called `permit_session` which will allow you to
load your `<iframe />` securly and successfully.

### Client-side logout method

This function should be called along with the logging-out logic that you have within your App, to make sure the user does not
continue to have access to the Permit Element.

<CodeDropdown
	number="5"
	title=""
	client
	code={[code.elementLogout]}
	language={["javascript"]}
	languages={["Node"]}
	open
>
	This logout method **should be called** as part of the logic of logging your
	user out with your authentication solution.
</CodeDropdown>

### Login Errors

There are a few possible errors you might find yourself come across while working with the embedding of Permit Elements.

| Error                      | Description                                                                                                                                                                                                                    |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `USER_NOT_FOUND`           | This error can appear if you are trying to log in as a particular user, but that user does not exist within Permit.                                                                                                            |
| `TENANT_NOT_FOUND`         | This error can appear when you are passing in a tenant, either in the frontend `permit.elements.login` function, or in your backend URL endpoint, where the tenant has not been created in Permit.                             |
| `INVALID_PERMISSION_LEVEL` | This error will emerge when you are trying to access part of the Element which you have not been given access too. This usually means the role that the person obtained has remained in the **Hidden Roles** permission level. |
| `FORBIDDEN_ACCESS`         | This error will emerge when you are trying to login to an Element you have not been given permission to see.                                                                                                                   |

## Customising your Element

Each element offers customization and configuration.

### Match your brand

With every new element, you will be able to adjust several setting to make the look and feel of the element really your own.

<div className="list">
	<ul>
		<li>
			<span>
				Change the background and primary colour of any element to match your
				brand.
			</span>
		</li>
		<li>
			<span>
				Give the element a title that makes sense to your end user, or hide it
				fully.
			</span>
		</li>
		<li>
			<span>
				Decide if you want to display your users Email, Full Name or both on the
				element.
			</span>
		</li>
	</ul>
</div>

_![Audit Logs Element](/img/elements/configuration.png)_

### Configure your webhook

With some Permit Elements, you will get the option to configure a webhook to stay informed of the actions that are performed by the end users.

_![Webhook](/img/elements/webhook.png)_

:::info EXAMPLE
For the User Management Element, a webhook will allow you to recieve updates when a user invites someone new into the system.
:::

You will need to generate a new webhook URL that points to the running server-side application. As part of the configuration you are required to pass in a secret key. This can be any key you generate like a SHA encryption key.

## Embedding the iFrame

After you finish configuring and customising your element, you are ready to it into your App. A code snippet for the element
will be generated for you.
This will be an `<iframe>` that you can insert anywhere into your website. It will look like the code snippet below.

```html
<iframe
	title="Permit Element Name"
	src="https://embed.permit.io/name?envId=<SOME_UNIQUE_ID>"
	width="100%"
	height="100%"
	style="border: none;"
/>
```

<HelpSupportTile />
