import HelpSupportTile from "@site/src/components/elements/HelpSupportTile.js";
import ActionContainer from "@site/src/components/elements/ActionContainer.js";
import ActionTile from "@site/src/components/elements/ActionTile.js";
import CodeDropdown from "@site/src/components/elements/CodeDropdown.js";
import FlexWrapper from "@site/src/components/elements/FlexWrapper.js";
import code from "@site/src/components/elements/codeBlock.json";

# User Management Element

<span className="subtitle-custom">
	Effortlessly manage users and their permissions as a single secure, embeddable
	UI component.
</span>
<br />
<br />
The User Management Element is an embeddable UI component that lets you take control
of your whole team, and give other team members specific permissions levels that
reflect how they can manage other users on your team.
<br />
<br />

_![Audit Logs Element](/img/elements/user-management-full.png)_

<h2>Element setup process</h2>

<FlexWrapper>
	<ActionTile
		title="1. Initialize Permit"
		description="Create an instance of Permit."
		redirect="/features/permit-elements/element/user-management#initializing-permit"
	/>
	<ActionTile
		title="2. Servier-side login route"
		description="Login a user securely into an element."
		redirect="/features/permit-elements/element/user-management#server-side-login-route"
	/>
	<ActionTile
		title="3. Install Permit"
		description="Install the permit-js package into your application."
		redirect="/features/permit-elements/element/user-management#install-permit-js"
	/>
	<ActionTile
		title="4. Client-side login method"
		description="Send the user unique ID to your backend."
		redirect="/features/permit-elements/element/user-management#client-side-login-method"
	/>
	<ActionTile
		title="5. Client-side logout method"
		description="Log the user out from the element."
		redirect="/features/permit-elements/element/user-management#client-side-logout-method"
	/>
	<ActionTile
		title="6. Possible login errors"
		description="Find out why you might be seeing some errors."
		redirect="/features/permit-elements/element/user-management#login-errors"
	/>
</FlexWrapper>

<h2>Element Configurtion and Customization</h2>

<FlexWrapper>
	<ActionTile
		alt
		title="1. Match your brand"
		description="Change colors, titles and buttons to what suits your brand most."
		redirect="/features/permit-elements/element/user-management#match-your-brand"
	/>
	<ActionTile
		alt
		title="2. Configure the Webhook"
		description="Stay informed of relevant events from your end users."
		redirect="/features/permit-elements/element/user-management#configure-your-webhook"
	/>
</FlexWrapper>

## Setting up your application

### Initializing Permit

<CodeDropdown
	number="1"
	title=""
	server
	code={[code.initialize_node, code.initialize_python, code.initialize_dotnet, code.initialize_java]}
	language={["javascript", "python", "c", "java"]}
	languages={["Node", "Python", "Dotnet", "Java"]}
	open
>
	{/* If you are already using Permit, you can skip this step. */}
	In order to use Permit Elements, you need to be a **user of Permit**. When starting to use Permit, you will need to 
	initialize an instance of Permit in your backend logic. This **only needs to be done once**, both to use Permit and Elements.
	Please rememeber to copy your `SDK Secret Key` and pass it into the initialized Permit object.


</CodeDropdown>

### Server-side Login Route

You need to create a route in your backend server to allow your client to `login_as` themselves and get access the Permit Element.

The backend `login_as` route is a bit different if your backend is using cookies bearer token or custom auth headers to authenticate users. 

You can choose the one that suits your backend best.

<CodeDropdown
	number="2.1"
	title="Using Cookies"
	server
	code={[code.cookies_node, code.cookies_python, code.cookies_dotnet, code.cookies_java]}
	language={["javascript", "python", "c", "java"]}
	languages={["Node", "Python", "Dotnet", "Java"]}
></CodeDropdown>

<CodeDropdown
	number="2.2"
	title="Using Bearer Token"
	server
	code={[code.bearer_node, code.bearer_python, code.bearer_dotnet, code.bearer_java]}
	language={["javascript", "python", "c", "java"]}
	languages={["Node", "Python", "Dotnet", "Java"]}
></CodeDropdown>

<CodeDropdown
	number="2.3"
	title="Using Other Headers"
	server
	code={[code.bearer_node, code.bearer_python, code.bearer_dotnet, code.bearer_java]}
	language={["javascript", "python", "c", "java"]}
	languages={["Node", "Python", "Dotnet", "Java"]}
>
	If you use custom Authentication Header to authenticate to your backend, add this route to your backend.
</CodeDropdown>

### Install Permit-js

Once you have your application ready, you need to install Permits's JS SDK. This gives you access to our prebuilt embeddable Element components.

<CodeDropdown
	number="3"
	title=""
	client
	code={[code.npm, code.yarn]}
	showLineNumbers={false}
	language={["javascript"]}
	languages={["npm", "yarn"]}
	open
>
	Add the Permit JavaScript SDK to you app:
</CodeDropdown>

### Client-side login method

This function should be called as early as possible in your App. This is best done inside a `App`/`index` file; **right after** the users
had just had their identity confirmed by the Authorization provider you are using, but **just before** the Embededd component is loaded.

<CodeDropdown
    number="4"
    title=""
    client
    code={[code.elementLogin]}
	language={["javascript"]}
	languages={["Node"]}
    open
>
    This is the permit element object that is calling the backend route we have
    configured previously and logging in the user.

</CodeDropdown>

There are **four** things that need to be configured here:

1.  `loginUrl` - The url that corresponds to your backend login route you created in the last step.
2.  `loginMethod` - The login method you are using in your backend.
3.  `tenant` (Optional) - The name of the tenant that the user is part of, you can set it at your backend as well.
4.  `token` (Optional) - If your login method is bearer token, you need to pass the token here.
5.  `headers` (Optional) - If your login method is custom headers, you need to pass the headers here.

There are **3 supported login options** choose the one that you are using in your backend.

<CodeDropdown
	number="4.1"
	title="Cookie Login Method"
	client
	code={[code.loginDefault]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.cookie`.
</CodeDropdown>

<CodeDropdown
	number="4.2"
	title="Bearer Token Login Method"
	client
	code={[code.loginHeaders]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.bearer` and the **token** should be set to the current user token.
</CodeDropdown>

<CodeDropdown
	number="4.3"
	title="Other Header Login Method"
	client
	code={[code.other_headers]}
	language={["javascript"]}
	languages={["Node"]}
	open={false}
>
	The **loginMethod** here should be set to: `LoginMethod: LoginMethod.header` and you should pass the **headers** to the current user auth headers.
</CodeDropdown>

After you run login successfully you will **get a cookie** called `permit_session` which will allow you to
load your Permit Element securly and successfully.

### Client-side logout method

This function should be called along with the logging-out logic that you have within your App, to make sure the user does not
continue to have access to the Permit Element.

<CodeDropdown
	number="5"
	title=""
	client
	code={[code.elementLogout]}
	language={["javascript"]}
	languages={["Node"]}
	open
>
	This logout method **should be called** as part of the logic of logging your
	user out with your authentication solution.
</CodeDropdown>

### Login Errors

There are a few possible errors you might find yourself come across while working with the embedding of Permit Elements.

| Error                      | Description                                                                                                                                                                                                                    |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `USER_NOT_FOUND`           | This error can appear if you are trying to log in as a particular user, but that user does not exist within Permit.                                                                                                            |
| `TENANT_NOT_FOUND`         | This error can appear when you are passing in a tenant, either in the frontend `permit.elements.login` function, or in your backend URL endpoint, where the tenant has not been created in Permit.                             |
| `INVALID_PERMISSION_LEVEL` | This error will emerge when you are trying to access part of the Element which you have not been given access too. This usually means the role that the person obtained has remained in the **Hidden Roles** permission level. |
| `FORBIDDEN_ACCESS`         | This error will emerge when you are trying to login to an Element you have not been given permission to see.                                                                                                                   |

## Customising your Element

Each element offers customization and configuration.

### Match your brand

With every new element, you will be able to adjust several setting to make the look and feel of the element really your own.

<div className="list">
	<ul>
		<li>
			<span>
				Change the background and primary colour of any element to match your
				brand.
			</span>
		</li>
		<li>
			<span>
				Give the element a title that makes sense to your end user, or hide it
				fully.
			</span>
		</li>
		<li>
			<span>
				Decide if you want to display your users Email, Full Name or both on the
				element.
			</span>
		</li>
	</ul>
</div>

_![Audit Logs Element](/img/elements/configuration.png)_

### Configure your webhook

With some Permit Elements, you will get the option to configure a webhook to stay informed of the actions that are performed by the end users.

_![Webhook](/img/elements/webhook.png)_

:::info EXAMPLE
For the User Management Element, a webhook will allow you to recieve updates each time a new user is created in your system.
:::

You will need to generate a new webhook URL that points to the running server-side application. As part of the configuration you are required to pass in a secret key and we will pass it as Bearer auth header with the user email role and level.

## Embedding the iFrame

After you finish configuring and customising your element, you are ready to it into your App. A code snippet for the element
will be generated for you.
This will be an `<iframe>` that you can insert anywhere into your website. It will look like the code snippet below.

```html
<iframe
	title="Permit Element Name"
	src="https://embed.permit.io/name?envId=<SOME_UNIQUE_ID>"
	width="100%"
	height="100%"
	style="border: none;"
/>
```

<HelpSupportTile />
